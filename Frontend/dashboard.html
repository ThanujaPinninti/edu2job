<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
body { margin:0; font-family: Arial, sans-serif; background:#f5f5f5; }
.dashboard { display:flex; min-height:100vh; }
.sidebar { width:230px; background:#111; padding:20px; color:#fff; }
.sidebar h2 { margin-bottom:30px; color:#0a66c2; }
.sidebar a { display:block; padding:10px; margin-bottom:10px; text-decoration:none; color:#ccc; border-radius:8px; }
.sidebar a.active, .sidebar a:hover { background:#0a66c2; color:#fff; }
.main { flex:1; padding:30px; overflow-y:auto; background: #cdd0d4; }
.container { max-width:900px; margin:auto; }
.card { background:#fff; border-radius:12px; padding:20px; margin-bottom:20px; }
.card h3 { margin-top:0; }
.list-item { margin-top:10px; padding:10px; border:1px solid #ddd; border-radius:8px; background:#fafafa; }
.profile-img { width:150px; height:150px; border-radius:50%; object-fit:cover; margin:15px 0; }
.project-card, .cert-card { display:flex; justify-content:space-between; align-items:flex-start; background:#f9f9f9; border:1px solid #ddd; border-radius:8px; padding:12px; margin-bottom:10px; }
.project-info, .cert-info { max-width:90%; }
.project-title, .cert-title { font-weight:600; font-size:15px; color:#111; }
.project-year { font-weight:normal; color:#555; margin-left:6px; }
.project-desc { margin-top:6px; font-size:14px; color:#444; }
.project-link, .cert-link { display:inline-block; margin-top:6px; font-size:13px; color:#0d6efd; text-decoration:none; }
.project-link:hover, .cert-link:hover { text-decoration:underline; }
</style>
</head>
<body>
<div class="dashboard">
<div class="sidebar">
    <h2>EDU2JOB</h2>
    <a href="dashboard.html" class="active">Dashboard</a>
    <a href="profile.html">Profile</a>
    <a href="job_predictions.html">Job Predictions</a>
    <a href="applications.html">Applications</a>
    <a href="career.html">Career</a>
    <a href="login.html">Logout</a>
</div>
<div class="main">
<div class="container">

<!-- 1. Profile Photo -->
<div class="card profile-card">
    <h3>Profile Photo</h3>
    <img id="profilePreview" src="" class="profile-img">
</div>

<!-- 2. User Information -->
<div class="card">
    <h3>User Information</h3>
    <div class="list-item"><b>Username:</b> <span id="username"></span></div>
    <div class="list-item"><b>Email:</b> <span id="email"></span></div>
    <div class="list-item"><b>Address:</b> <span id="address"></span></div>
    <div class="list-item"><b>Phone:</b> <span id="phone"></span></div>
    <div class="list-item"><b>Work Status:</b> <span id="workStatus"></span></div>
    <div class="list-item"><b>LinkedIn:</b> <span id="linkedin"></span></div>
    <div class="list-item"><b>GitHub:</b> <span id="github"></span></div>
    <div class="list-item"><b>Gender:</b> <span id="gender"></span></div>
    <div class="list-item"><b>Date of Birth:</b> <span id="dob"></span></div>
    <div class="list-item"><b>Marital Status:</b> <span id="maritalStatus"></span></div>
</div>

<!-- 3. Resume -->
<div class="card">
    <h3>Resume</h3>
    <div id="resumePreview" class="list-item" style="display:none;">
        ðŸ“„ <a id="resumeLink" href="#" target="_blank"></a>
    </div>
</div>

<!-- 4. Skills -->
<div class="card">
    <h3>Key Skills</h3>
    <div id="skillList"></div>
</div>

<!-- 5. Languages -->
<div class="card">
    <h3>Languages Known</h3>
    <div id="langList"></div>
</div>

<!-- 6. Projects -->
<div class="card">
    <h3>Projects</h3>
    <div id="projectList"></div>
</div>

<!-- 7. Education -->
<div class="card">
    <h3>Education Information</h3>
    <div id="educationList"></div>
</div>

<!-- 8. Experience -->
<div class="card">
    <h3>Experience</h3>
    <div id="experienceList"></div>
</div>

<!-- 9. Certifications -->
<div class="card">
    <h3>Certifications</h3>
    <div id="certList"></div>
</div>

</div>
</div>
</div>

<script>
const BASE_URL = "http://127.0.0.1:5000";
const token = localStorage.getItem("token");

async function api(url, method="GET") {
    const options = { method, headers: {} };
    if(token) options.headers["Authorization"] = "Bearer " + token;
    const res = await fetch(BASE_URL + url, options);
    return await res.json();
}

function formatDate(dateStr) {
    if(!dateStr) return "";
    const d = new Date(dateStr);
    if(isNaN(d)) return dateStr;
    return d.toLocaleDateString();
}

// 1 & 2. Profile and User Info
async function loadProfile() {
    const data = await api("/profile/get");
    if(!data.success) return;
    document.getElementById("username").innerText = data.username || "";
    document.getElementById("email").innerText = data.email || "";
    document.getElementById("address").innerText = data.address || "";
    document.getElementById("phone").innerText = data.phone || "";
    document.getElementById("workStatus").innerText = data.work_status || "";
    document.getElementById("linkedin").innerText = data.linkedin || "";
    document.getElementById("github").innerText = data.github || "";
    document.getElementById("gender").innerText = data.gender || "";
    document.getElementById("dob").innerText = formatDate(data.dob);
    document.getElementById("maritalStatus").innerText = data.marital_status || "";
}

async function loadProfilePhoto() {
    const img = document.getElementById("profilePreview");
    img.src = BASE_URL + "/profile/photo/get";
}

// 3. Resume
async function loadResume() {
    const res = await api("/profile/resume");
    const preview = document.getElementById("resumePreview");
    const link = document.getElementById("resumeLink");
    if(res.success) {
        preview.style.display = "block";
        link.href = BASE_URL + "/profile/resume/view";
        link.innerText = res.file_name;
    } else {
        preview.style.display = "none";
    }
}

// 4. Skills
async function loadSkills() {
    const res = await api("/profile/skills/get");
    const list = document.getElementById("skillList");
    list.innerHTML = "";
    (res.skills || []).forEach(s => {
        const div = document.createElement("div");
        div.className = "list-item";
        div.innerText = s.skill;
        list.appendChild(div);
    });
}

// 5. Languages
async function loadLanguages() {
    const res = await api("/profile/languages/get");
    const list = document.getElementById("langList");
    list.innerHTML = "";
    (res.languages || []).forEach(l => {
        const div = document.createElement("div");
        div.className = "list-item";
        div.innerText = l.language;
        list.appendChild(div);
    });
}

// 6. Projects
async function loadProjects() {
    const res = await api("/profile/projects/get");
    const list = document.getElementById("projectList");
    list.innerHTML = "";
    (res.projects || []).forEach(p => {
        const div = document.createElement("div");
        div.className = "project-card";
        div.innerHTML = `
            <div class="project-info">
                <div class="project-title">${p.name} ${p.year ? `<span class="project-year">(${p.year})</span>` : ""}</div>
                ${p.desc ? `<div class="project-desc">${p.desc}</div>` : ""}
                ${p.link ? `<a class="project-link" href="${p.link}" target="_blank">View Project</a>` : ""}
            </div>
        `;
        list.appendChild(div);
    });
}

// 7. Education
async function loadEducation() {
    const res = await api("/profile/education/get");
    const list = document.getElementById("educationList");
    list.innerHTML = "";
    (res.education || []).forEach(e => {
        const div = document.createElement("div");
        div.className = "list-item";
        div.innerHTML = `<b>${e.degree}</b> (${e.start} - ${e.end})<br>${e.spec} â€” CGPA: ${e.cgpa}`;
        list.appendChild(div);
    });
}

// 8. Experience
async function loadExperience() {
    const res = await api("/profile/experience/get");
    const list = document.getElementById("experienceList");
    list.innerHTML = "";
    (res.experiences || []).forEach(ex => {
        const div = document.createElement("div");
        div.className = "list-item";
        div.innerHTML = `<b>${ex.c}</b> (${ex.s || "N/A"} â†’ ${ex.e || "Present"})<br>${ex.d || ""}`;
        list.appendChild(div);
    });
}

// 9. Certifications
async function loadCertifications() {
    const res = await api("/profile/certifications/get");
    const list = document.getElementById("certList");
    list.innerHTML = "";
    (res.certificates || []).forEach(c => {
        const div = document.createElement("div");
        div.className = "cert-card";
        div.innerHTML = `
            <div class="cert-info">
                <div class="cert-title">${c.course}</div>
                <div class="cert-company">${c.company || ""}</div>
                ${c.link ? `<a class="cert-link" href="${c.link}" target="_blank">View Certificate</a>` : ""}
            </div>
        `;
        list.appendChild(div);
    });
}

async function loadAll() {
    await loadProfile();
    await loadProfilePhoto();
    await loadResume();
    await loadSkills();
    await loadLanguages();
    await loadProjects();
    await loadEducation();
    await loadExperience();
    await loadCertifications();
}

loadAll();
window.onload = function() {
    logActivity("Visited Dashboard Page");
    loadActivityHistory();
};

</script>
</body>
</html>
